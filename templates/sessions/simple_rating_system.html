<!-- Simple Working Rating System -->
<div id="ratingSystemModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Rate This Session</h3>
            
            <!-- Star Rating -->
            <div class="flex justify-center mb-4">
                <div class="flex space-x-1" id="starRating">
                    <button type="button" class="star-btn text-3xl text-gray-300 hover:text-yellow-400" data-rating="1">★</button>
                    <button type="button" class="star-btn text-3xl text-gray-300 hover:text-yellow-400" data-rating="2">★</button>
                    <button type="button" class="star-btn text-3xl text-gray-300 hover:text-yellow-400" data-rating="3">★</button>
                    <button type="button" class="star-btn text-3xl text-gray-300 hover:text-yellow-400" data-rating="4">★</button>
                    <button type="button" class="star-btn text-3xl text-gray-300 hover:text-yellow-400" data-rating="5">★</button>
                </div>
            </div>
            
            <p class="text-center text-gray-600 mb-4" id="ratingText">Click stars to rate</p>
            
            <!-- Comment -->
            <textarea 
                id="ratingCommentBox" 
                rows="3" 
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4"
                placeholder="Share your experience..."></textarea>
            
            <!-- Buttons -->
            <div class="flex space-x-3">
                <button 
                    onclick="closeRatingModal()" 
                    class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                    Skip
                </button>
                <button 
                    onclick="submitNewRating()" 
                    id="submitBtn" 
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
                    disabled>
                    Submit Rating
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let selectedStars = 0;

// Initialize star rating system
document.querySelectorAll('.star-btn').forEach(star => {
    star.addEventListener('click', function() {
        selectedStars = parseInt(this.dataset.rating);
        updateStars();
        document.getElementById('submitBtn').disabled = false;
    });
});

function updateStars() {
    document.querySelectorAll('.star-btn').forEach((star, index) => {
        if (index < selectedStars) {
            star.className = 'star-btn text-3xl text-yellow-400';
        } else {
            star.className = 'star-btn text-3xl text-gray-300 hover:text-yellow-400';
        }
    });
    
    const ratingTexts = ['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];
    document.getElementById('ratingText').textContent = ratingTexts[selectedStars] || 'Click stars to rate';
}

function openNewRatingModal() {
    document.getElementById('ratingSystemModal').classList.remove('hidden');
}

function closeRatingModal() {
    document.getElementById('ratingSystemModal').classList.add('hidden');
    selectedStars = 0;
    updateStars();
    document.getElementById('ratingCommentBox').value = '';
    document.getElementById('submitBtn').disabled = true;
}

async function submitNewRating() {
    if (selectedStars === 0) {
        alert('Please select a rating');
        return;
    }
    
    const comment = document.getElementById('ratingCommentBox').value;
    
    try {
        const response = await fetch(`/sessions/api/sessions/{{ session.id }}/submit-rating/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({
                rating: selectedStars,
                comment: comment,
                session_id: '{{ session.id }}'
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Rating submitted successfully!');
            closeRatingModal();
        } else {
            alert('Failed to submit rating: ' + (data.message || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to submit rating. Please try again.');
    }
}
</script>